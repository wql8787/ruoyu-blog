<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>å‘½è¿æ˜Ÿç›˜</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ==================== 1. åŸºç¡€ç¯å¢ƒ ==================== */
        body {
            margin: 0; min-height: 100vh;
            background-color: #0f0b15;
            display: flex; justify-content: center; align-items: center;
            font-family: "Noto Serif SC", "Cinzel", serif;
            overflow-x: hidden; overflow-y: auto; perspective: 1600px;
        }

        .nebula-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: 
                radial-gradient(circle at 50% 120%, rgba(100, 50, 160, 0.3) 0%, transparent 60%),
                radial-gradient(circle at 20% 20%, rgba(200, 150, 50, 0.05) 0%, transparent 40%),
                #0f0b15;
            z-index: -2;
        }

        .dust {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://www.transparenttextures.com/patterns/stardust.png');
            opacity: 0.4; animation: drift 60s linear infinite;
            z-index: -1; pointer-events: none;
        }
        @keyframes drift { from { background-position: 0 0; } to { background-position: 100px 100px; } }

        /* ==================== 2. æ°´æ™¶çƒ ==================== */
        .crystal-container {
            position: absolute; top: 50px; left: 50%; transform: translateX(-50%);
            width: 140px; height: 140px; z-index: 0; pointer-events: none;
        }
        .crystal-ball {
            width: 120px; height: 120px; border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), rgba(138, 43, 226, 0.2) 40%, rgba(20, 0, 40, 0.6) 90%);
            box-shadow: 0 0 40px rgba(138, 43, 226, 0.4), inset 0 0 20px rgba(138, 43, 226, 0.3);
            animation: pulse 4s ease-in-out infinite; margin: 0 auto;
        }
        .crystal-base {
            width: 80px; height: 20px; background: linear-gradient(90deg, #3e2723, #d4af37, #3e2723);
            border-radius: 50%; margin: -10px auto 0; box-shadow: 0 10px 20px black;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 40px rgba(138, 43, 226, 0.4); }
            50% { transform: scale(1.02); box-shadow: 0 0 60px rgba(138, 43, 226, 0.6); }
        }

        /* ==================== 3. å¡ç‰Œå¸ƒå±€ ==================== */
        .cards-layout {
            display: flex; gap: 40px; margin-top: 180px; padding-bottom: 80px; 
            z-index: 10; flex-wrap: wrap; justify-content: center; width: 100%;
        }

        .card-wrapper {
            width: 280px; height: 460px; position: relative; cursor: pointer;
            transform-style: preserve-3d; transition: transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
            -webkit-tap-highlight-color: transparent;
        }
        .card-wrapper:hover { transform: translateY(-10px); }
        .card-wrapper.flipped { transform: rotateY(180deg); }
        
        /* ä¿®å¤èƒŒé¢ç©¿æ¨¡ */
        .card-wrapper.flipped .back { opacity: 0; transition: opacity 0s linear 0.4s; pointer-events: none; }
        .card-wrapper:not(.flipped) .back { opacity: 1; transition: opacity 0s linear 0s; }

        .face {
            position: absolute; width: 100%; height: 100%; border-radius: 12px;
            -webkit-backface-visibility: hidden; backface-visibility: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.7); overflow: hidden; border: 1px solid #d4af37;
        }

        /* === å¡èƒŒ === */
        .back {
            background-color: #150f1f;
            background-image: 
                linear-gradient(45deg, #150f1f 75%, transparent 75%),
                linear-gradient(135deg, #150f1f 75%, transparent 75%),
                linear-gradient(225deg, #150f1f 75%, transparent 75%),
                linear-gradient(315deg, #150f1f 75%, transparent 75%),
                radial-gradient(circle, #d4af37 2px, transparent 2.5px);
            background-size: 20px 20px, 40px 40px; background-position: 0 0, 20px 20px;
            border: 8px solid #2a1d35; display: flex; justify-content: center; align-items: center; z-index: 2;
        }
        .totem {
            width: 140px; height: 140px; border: 2px solid #d4af37; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; position: relative;
            background: #150f1f; box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
        }
        .totem::before {
            content: ""; position: absolute; width: 100px; height: 100px;
            border: 2px solid #d4af37; transform: rotate(45deg);
        }
        .totem-symbol { font-size: 50px; color: #d4af37; z-index: 2; text-shadow: 0 0 10px rgba(212, 175, 55, 0.5); }

        /* === æ­£é¢ === */
        .front {
            background: #fdf6e3; transform: rotateY(180deg);
            background-image: url('https://www.transparenttextures.com/patterns/aged-paper.png');
            display: flex; flex-direction: column; border: 6px solid #2a1d35; z-index: 1;
        }
        .front-frame {
            flex: 1; margin: 6px; border: 2px solid #d4af37; padding: 20px;
            position: relative; display: flex; flex-direction: column; align-items: center;
        }
        .ornament { position: absolute; width: 20px; height: 20px; border-top: 3px double #d4af37; border-left: 3px double #d4af37; }
        .tl { top: 4px; left: 4px; } .tr { top: 4px; right: 4px; transform: rotate(90deg); }
        .bl { bottom: 4px; left: 4px; transform: rotate(-90deg); } .br { bottom: 4px; right: 4px; transform: rotate(180deg); }

        h2 {
            font-family: "Noto Serif SC", serif; font-size: 22px; margin: 10px 0; color: #2a1d35;
            border-bottom: 1px solid #d4af37; padding-bottom: 8px; width: 100%; text-align: center; letter-spacing: 2px;
        }

        .magic-btn {
            margin-top: auto; background: transparent; border: 1px solid #2a1d35; padding: 10px 30px;
            font-family: "Noto Serif SC", serif; font-size: 16px; color: #2a1d35; cursor: pointer;
            transition: 0.3s; position: relative; overflow: hidden; -webkit-tap-highlight-color: transparent;
        }
        .magic-btn:hover { background: #2a1d35; color: #d4af37; }

        .result-text {
            font-size: 32px; font-weight: bold; color: #8b0000; min-height: 80px;
            display: flex; align-items: center; justify-content: center; text-align: center; margin-top: 40px;
        }

        .art-box {
            width: 100%; height: 200px; background: #eee; border: 1px solid #2a1d35;
            margin: 10px 0; overflow: hidden; position: relative;
        }
        .art-img { width: 100%; height: 100%; background-size: cover; background-position: center; transition: opacity 0.3s; }
        
        /* éŸ³ä¹å¾‹åŠ¨ */
        .equalizer {
            display: flex; justify-content: center; align-items: flex-end;
            height: 30px; gap: 4px; margin-top: 10px; opacity: 0; transition: opacity 0.5s;
        }
        .bar { width: 6px; background: #d4af37; animation: bounce 1s infinite ease-in-out; }
        .bar:nth-child(1) { height: 10px; animation-delay: 0.1s; }
        .bar:nth-child(2) { height: 20px; animation-delay: 0.3s; }
        .bar:nth-child(3) { height: 15px; animation-delay: 0.2s; }
        .bar:nth-child(4) { height: 25px; animation-delay: 0.4s; }
        .bar:nth-child(5) { height: 12px; animation-delay: 0.1s; }
        @keyframes bounce { 0%, 100% { transform: scaleY(1); } 50% { transform: scaleY(1.5); } }

        .hint {
            position: fixed; bottom: 20px; width: 100%; text-align: center;
            color: rgba(212, 175, 55, 0.4); font-size: 12px; letter-spacing: 2px;
            text-transform: uppercase; pointer-events: none;
        }
        
        .play-hint { font-size: 12px; color: #999; margin-top: 5px; min-height: 18px; }
    </style>
</head>
<body>
    <div class="nebula-bg"></div>
    <div class="dust"></div>
    <div class="crystal-container"><div class="crystal-ball"></div><div class="crystal-base"></div></div>

    <div class="cards-layout">
        
        <div class="card-wrapper" onclick="flipCard(this, 'fate')">
            <div class="face back"><div class="totem"><div class="totem-symbol">âœ¦</div></div></div>
            <div class="face front">
                <div class="front-frame">
                    <div class="ornament tl"></div><div class="ornament tr"></div><div class="ornament bl"></div><div class="ornament br"></div>
                    <h2>å‘½è¿ä¹‹è½®</h2>
                    <p style="font-size: 13px; color: #666; font-style: italic;">â€œå¿ƒä¸­çš„å›°æƒ‘ï¼Œåœ¨æ­¤æ˜¾ç°â€</p>
                    <div class="result-text" id="fate-text">?</div>
                    <button class="magic-btn" onclick="askDestiny(event)">æ­ç¤ºæŒ‡å¼•</button>
                </div>
            </div>
        </div>

        <div class="card-wrapper" onclick="flipCard(this, 'art')">
            <div class="face back"><div class="totem"><div class="totem-symbol">ğŸ‘</div></div></div>
            <div class="face front">
                <div class="front-frame">
                    <div class="ornament tl"></div><div class="ornament tr"></div><div class="ornament bl"></div><div class="ornament br"></div>
                    <h2>å¼‚ç•Œä¹‹çª—</h2>
                    <div class="art-box"><div class="art-img" id="art-img" style="background-image: url('https://img.paulzzh.com/touhou/random');"></div></div>
                    <div style="text-align: center;">
                        <p style="font-size: 14px; margin: 5px 0;">"å‡è§†æ·±æ¸Š..."</p>
                        <small style="color: #999; font-size: 12px;">ç¿»é¢è‡ªåŠ¨åˆ·æ–°è§‚æµ‹</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="card-wrapper" onclick="flipCard(this, 'noise')">
            <div class="face back"><div class="totem"><div class="totem-symbol">â™«</div></div></div>
            <div class="face front">
                <div class="front-frame">
                    <div class="ornament tl"></div><div class="ornament tr"></div><div class="ornament bl"></div><div class="ornament br"></div>
                    
                    <h2 id="noise-title">é™è°§é’¢ç´</h2>
                    
                    <div class="art-box" style="height: 180px;">
                        <div class="art-img" id="noise-bg" style="background-image: url('https://images.weserv.nl/?url=https://images.unsplash.com/photo-1520523839897-bd0b52f945a0?w=600&fit=crop');"></div>
                    </div>
                    
                    <div class="equalizer" id="noise-eq">
                        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                    </div>
                    
                    <div class="play-hint" id="play-status">ç¿»å¼€å³æ’­ Â· ç¿»å›åœæ­¢</div>

                    <audio id="audio-player" loop preload="auto">
                        <source id="audio-source" src="" type="audio/mpeg">
                    </audio>
                </div>
            </div>
        </div>

    </div>

    <div class="hint">ç‚¹å‡»å¡ç‰‡ç¿»é¢åˆ·æ–° Â· éŸ³ä¹å¡ç¿»å¼€å³æ’­</div>

    <script>
        // ==================== 0. MP3 ç¨³å®šéŸ³æº (ç»å¯¹å…¼å®¹ç‰ˆ) ====================
        // ä½¿ç”¨ Mixkit çš„å…è´¹å•†ç”¨ MP3ï¼Œç¡®ä¿ iPhone/Android/PC éƒ½èƒ½æ’­
        const sounds = [
            { 
                name: "é™è°§é’¢ç´", 
                audio: "https://assets.mixkit.co/active_storage/sfx/133/133-preview.mp3", // æŸ”å’Œé’¢ç´
                img: "https://images.weserv.nl/?url=https://images.unsplash.com/photo-1520523839897-bd0b52f945a0?w=600&fit=crop" // é’¢ç´å›¾
            },
            { 
                name: "æ—é—´é¸Ÿè¯­", 
                audio: "https://assets.mixkit.co/active_storage/sfx/2434/2434-preview.mp3", // é¸Ÿå«
                img: "https://images.weserv.nl/?url=https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=600&fit=crop" // æ£®æ—å›¾
            },
            { 
                name: "æ¸©æŸ”æµ·æµª", 
                audio: "https://assets.mixkit.co/active_storage/sfx/119/119-preview.mp3", // æµªèŠ±
                img: "https://images.weserv.nl/?url=https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=600&fit=crop" // æµ·è¾¹å›¾
            },
            { 
                name: "ç»†é›¨å¾®é£", 
                audio: "https://assets.mixkit.co/active_storage/sfx/2481/2481-preview.mp3", // æŸ”å’Œå°é›¨
                img: "https://images.weserv.nl/?url=https://images.unsplash.com/photo-1515694346937-94d85e41e6f0?w=600&fit=crop" // é›¨çª—å›¾
            }
        ];

        // é¢„åŠ è½½
        const player = document.getElementById('audio-player');
        const source = document.getElementById('audio-source');
        let currentSound = sounds[0];
        
        source.src = currentSound.audio;
        // æŸäº›æµè§ˆå™¨éœ€è¦ load æ‰èƒ½è¯†åˆ«æ–° src
        player.load();

        // ==================== 1. ç¿»ç‰Œé€»è¾‘ ====================
        function flipCard(card, type) {
            const isFlipped = card.classList.contains('flipped');
            const eq = document.getElementById('noise-eq');
            const status = document.getElementById('play-status');

            if (isFlipped) {
                // -> å‡†å¤‡åˆä¸Š
                card.classList.remove('flipped');
                
                // éŸ³ä¹å¡åˆä¸Šï¼šç«‹åˆ»æš‚åœ
                if (type === 'noise') {
                    player.pause();
                    eq.style.opacity = 0; 
                    status.innerText = "å·²æš‚åœ (ç¿»å¼€åˆ‡æ­Œ)";
                    // 600ms ååˆ‡æ¢ä¸‹ä¸€é¦–æ•°æ®
                    setTimeout(() => { refreshData(type); }, 600);
                } else {
                    setTimeout(() => { refreshData(type); }, 600);
                }

            } else {
                // -> å‡†å¤‡ç¿»å¼€
                card.classList.add('flipped');

                // éŸ³ä¹å¡ç¿»å¼€ï¼šå°è¯•æ’­æ”¾
                if (type === 'noise') {
                    // Promise å¤„ç†ï¼šé˜²æ­¢æµè§ˆå™¨æŠ¥é”™
                    const playPromise = player.play();
                    
                    if (playPromise !== undefined) {
                        playPromise.then(_ => {
                            // æ’­æ”¾æˆåŠŸ
                            eq.style.opacity = 1;
                            status.innerText = "ğŸµ æ²»æ„ˆæ’­æ”¾ä¸­...";
                        })
                        .catch(error => {
                            // è‡ªåŠ¨æ’­æ”¾è¢«æ‹¦æˆª (å¸¸è§äº Safari çœç”µæ¨¡å¼)
                            console.log("è‡ªåŠ¨æ’­æ”¾è¢«æ‹¦æˆª:", error);
                            eq.style.opacity = 0;
                            status.innerText = "âš ï¸ è¯·ç‚¹å‡»æ­¤å¤„æ’­æ”¾";
                            // ç»™æ•´ä¸ªå¡é¢åŠ ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ä½œä¸ºè¡¥æ•‘
                            card.onclick = function() { player.play(); eq.style.opacity = 1; card.onclick = null; }; 
                        });
                    }
                }
            }
        }

        // ==================== 2. æ•°æ®åˆ·æ–°é€»è¾‘ ====================
        function refreshData(type) {
            const ts = new Date().getTime();

            if (type === 'art') {
                document.getElementById('art-img').style.backgroundImage = `url('https://img.paulzzh.com/touhou/random?t=${ts}')`;
            } 
            else if (type === 'fate') {
                const fateText = document.getElementById('fate-text');
                fateText.innerText = "?";
                fateText.style.color = "#8b0000";
            }
            else if (type === 'noise') {
                // éšæœºæ¢æ­Œ
                const randomSound = sounds[Math.floor(Math.random() * sounds.length)];
                
                document.getElementById('noise-title').innerText = randomSound.name;
                document.getElementById('noise-bg').style.backgroundImage = `url('${randomSound.img}')`;
                
                source.src = randomSound.audio;
                player.load(); // å…³é”®ï¼šåŠ è½½æ–°èµ„æº
                document.getElementById('play-status').innerText = "ç¿»å¼€å³æ’­ Â· ç¿»å›åœæ­¢";
            }
        }

        // ==================== 3. å‘½è¿å åœé€»è¾‘ ====================
        const destinyOptions = ["æ­¤æ—¶è¡ŒåŠ¨", "é™è§‚å…¶å˜", "ç›¸ä¿¡ç›´è§‰", "å¤§åƒä¸€é¡¿", "ç«‹åˆ»ç¡è§‰", "å‡ºé—¨æ•£æ­¥", "å¤ä¹ åŠŸè¯¾", "é‡åˆ·ç•ªå‰§", "åšæŒå·±è§", "è”ç³»è€å‹"];
        function askDestiny(e) {
            e.stopPropagation();
            const textEl = document.getElementById('fate-text');
            let count = 0;
            textEl.style.color = "#8b0000"; textEl.style.transform = "scale(1)";
            const timer = setInterval(() => {
                const randomIndex = Math.floor(Math.random() * destinyOptions.length);
                textEl.innerText = destinyOptions[randomIndex];
                count++;
                if (count >= 15) {
                    clearInterval(timer);
                    textEl.style.color = "#d4af37";
                    textEl.style.transform = "scale(1.2)";
                    textEl.style.transition = "transform 0.2s";
                    setTimeout(() => textEl.style.transform = "scale(1)", 200);
                }
            }, 50);
        }
    </script>
</body>
</html>
