<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>å‘½è¿æ˜Ÿç›˜</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ==================== 1. åŸºç¡€ç¯å¢ƒ ==================== */
        body {
            margin: 0; min-height: 100vh;
            background-color: #0f0b15;
            display: flex; justify-content: center; align-items: center;
            font-family: "Noto Serif SC", "Cinzel", serif;
            overflow-x: hidden; overflow-y: auto; perspective: 1600px;
        }

        .nebula-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: 
                radial-gradient(circle at 50% 120%, rgba(100, 50, 160, 0.3) 0%, transparent 60%),
                radial-gradient(circle at 20% 20%, rgba(200, 150, 50, 0.05) 0%, transparent 40%),
                #0f0b15;
            z-index: -2;
        }

        .dust {
            position: fixed; top: 0; left: 100%; width: 100%; height: 100%;
            background-image: url('https://www.transparenttextures.com/patterns/stardust.png');
            opacity: 0.4; animation: drift 60s linear infinite;
            z-index: -1; pointer-events: none;
        }
        @keyframes drift { from { background-position: 0 0; } to { background-position: 100px 100px; } }

        /* ==================== 2. æ°´æ™¶çƒ ==================== */
        .crystal-container {
            position: absolute; top: 50px; left: 50%; transform: translateX(-50%);
            width: 140px; height: 140px; z-index: 0; pointer-events: none;
        }
        .crystal-ball {
            width: 120px; height: 120px; border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), rgba(138, 43, 226, 0.2) 40%, rgba(20, 0, 40, 0.6) 90%);
            box-shadow: 0 0 40px rgba(138, 43, 226, 0.4), inset 0 0 20px rgba(138, 43, 226, 0.3);
            animation: pulse 4s ease-in-out infinite; margin: 0 auto;
        }
        .crystal-base {
            width: 80px; height: 20px; background: linear-gradient(90deg, #3e2723, #d4af37, #3e2723);
            border-radius: 50%; margin: -10px auto 0; box-shadow: 0 10px 20px black;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 40px rgba(138, 43, 226, 0.4); }
            50% { transform: scale(1.02); box-shadow: 0 0 60px rgba(138, 43, 226, 0.6); }
        }

        /* ==================== 3. å¡ç‰Œå¸ƒå±€ ==================== */
        .cards-layout {
            display: flex; gap: 40px; margin-top: 180px; padding-bottom: 80px; 
            z-index: 10; flex-wrap: wrap; justify-content: center; width: 100%;
        }

        .card-wrapper {
            width: 280px; height: 460px; position: relative; cursor: pointer;
            transform-style: preserve-3d; transition: transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
            -webkit-tap-highlight-color: transparent;
        }
        .card-wrapper:hover { transform: translateY(-10px); }
        .card-wrapper.flipped { transform: rotateY(180deg); }
        
        /* ä¿®å¤èƒŒé¢ç©¿æ¨¡ */
        .card-wrapper.flipped .back { opacity: 0; transition: opacity 0s linear 0.4s; pointer-events: none; }
        .card-wrapper:not(.flipped) .back { opacity: 1; transition: opacity 0s linear 0s; }

        .face {
            position: absolute; width: 100%; height: 100%; border-radius: 12px;
            -webkit-backface-visibility: hidden; backface-visibility: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.7); overflow: hidden; border: 1px solid #d4af37;
        }

        /* === å¡èƒŒ === */
        .back {
            background-color: #150f1f;
            background-image: 
                linear-gradient(45deg, #150f1f 75%, transparent 75%),
                linear-gradient(135deg, #150f1f 75%, transparent 75%),
                linear-gradient(225deg, #150f1f 75%, transparent 75%),
                linear-gradient(315deg, #150f1f 75%, transparent 75%),
                radial-gradient(circle, #d4af37 2px, transparent 2.5px);
            background-size: 20px 20px, 40px 40px; background-position: 0 0, 20px 20px;
            border: 8px solid #2a1d35; display: flex; justify-content: center; align-items: center; z-index: 2;
        }
        .totem {
            width: 140px; height: 140px; border: 2px solid #d4af37; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; position: relative;
            background: #150f1f; box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
        }
        .totem::before {
            content: ""; position: absolute; width: 100px; height: 100px;
            border: 2px solid #d4af37; transform: rotate(45deg);
        }
        .totem-symbol { font-size: 50px; color: #d4af37; z-index: 2; text-shadow: 0 0 10px rgba(212, 175, 55, 0.5); }

        /* === æ­£é¢ === */
        .front {
            background: #fdf6e3; transform: rotateY(180deg);
            background-image: url('https://www.transparenttextures.com/patterns/aged-paper.png');
            display: flex; flex-direction: column; border: 6px solid #2a1d35; z-index: 1;
        }
        .front-frame {
            flex: 1; margin: 6px; border: 2px solid #d4af37; padding: 20px;
            position: relative; display: flex; flex-direction: column; align-items: center;
        }
        .ornament { position: absolute; width: 20px; height: 20px; border-top: 3px double #d4af37; border-left: 3px double #d4af37; }
        .tl { top: 4px; left: 4px; } .tr { top: 4px; right: 4px; transform: rotate(90deg); }
        .bl { bottom: 4px; left: 4px; transform: rotate(-90deg); } .br { bottom: 4px; right: 4px; transform: rotate(180deg); }

        h2 {
            font-family: "Noto Serif SC", serif; font-size: 22px; margin: 10px 0; color: #2a1d35;
            border-bottom: 1px solid #d4af37; padding-bottom: 8px; width: 100%; text-align: center; letter-spacing: 2px;
        }

        .magic-btn {
            margin-top: auto; background: transparent; border: 1px solid #2a1d35; padding: 10px 30px;
            font-family: "Noto Serif SC", serif; font-size: 16px; color: #2a1d35; cursor: pointer;
            transition: 0.3s; position: relative; overflow: hidden; -webkit-tap-highlight-color: transparent;
        }
        .magic-btn:hover { background: #2a1d35; color: #d4af37; }

        .result-text {
            font-size: 32px; font-weight: bold; color: #8b0000; min-height: 80px;
            display: flex; align-items: center; justify-content: center; text-align: center; margin-top: 40px;
        }

        .art-box {
            width: 100%; height: 200px; background: #eee; border: 1px solid #2a1d35;
            margin: 10px 0; overflow: hidden; position: relative;
        }
        .art-img { width: 100%; height: 100%; background-size: cover; background-position: center; transition: opacity 0.3s; }
        
        /* Spotify å®¹å™¨æ ·å¼ */
        .spotify-box {
            width: 100%; 
            height: 352px; /* Spotify åµŒå…¥çš„æ ‡å‡†é«˜åº¦ */
            border-radius: 12px;
            overflow: hidden;
            background: #282828;
            border: 1px solid #d4af37;
            display: flex; justify-content: center; align-items: center;
        }
        .spotify-placeholder { color: #888; font-size: 12px; }

        .hint {
            position: fixed; bottom: 20px; width: 100%; text-align: center;
            color: rgba(212, 175, 55, 0.4); font-size: 12px; letter-spacing: 2px;
            text-transform: uppercase; pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="nebula-bg"></div>
    <div class="dust"></div>
    <div class="crystal-container"><div class="crystal-ball"></div><div class="crystal-base"></div></div>

    <div class="cards-layout">
        
        <div class="card-wrapper" onclick="flipCard(this, 'fate')">
            <div class="face back"><div class="totem"><div class="totem-symbol">âœ¦</div></div></div>
            <div class="face front">
                <div class="front-frame">
                    <div class="ornament tl"></div><div class="ornament tr"></div><div class="ornament bl"></div><div class="ornament br"></div>
                    <h2>å‘½è¿ä¹‹è½®</h2>
                    <p style="font-size: 13px; color: #666; font-style: italic;">â€œå¿ƒä¸­çš„å›°æƒ‘ï¼Œåœ¨æ­¤æ˜¾ç°â€</p>
                    <div class="result-text" id="fate-text">?</div>
                    <button class="magic-btn" onclick="askDestiny(event)">æ­ç¤ºæŒ‡å¼•</button>
                </div>
            </div>
        </div>

        <div class="card-wrapper" onclick="flipCard(this, 'art')">
            <div class="face back"><div class="totem"><div class="totem-symbol">ğŸ‘</div></div></div>
            <div class="face front">
                <div class="front-frame">
                    <div class="ornament tl"></div><div class="ornament tr"></div><div class="ornament bl"></div><div class="ornament br"></div>
                    <h2>å¼‚ç•Œä¹‹çª—</h2>
                    <div class="art-box"><div class="art-img" id="art-img" style="background-image: url('https://img.paulzzh.com/touhou/random');"></div></div>
                    <div style="text-align: center;">
                        <p style="font-size: 14px; margin: 5px 0;">"å‡è§†æ·±æ¸Š..."</p>
                        <small style="color: #999; font-size: 12px;">ç¿»é¢è‡ªåŠ¨åˆ·æ–°è§‚æµ‹</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="card-wrapper" onclick="flipCard(this, 'spotify')">
            <div class="face back"><div class="totem"><div class="totem-symbol">â™«</div></div></div>
            <div class="face front">
                <div class="front-frame">
                    <div class="ornament tl"></div><div class="ornament tr"></div><div class="ornament bl"></div><div class="ornament br"></div>
                    
                    <div class="spotify-box" id="spotify-container">
                        <div class="spotify-placeholder">ç‚¹å‡»ç¿»å¼€åŠ è½½éŸ³ä¹</div>
                    </div>
                    
                    <div style="font-size: 12px; color: #999; margin-top: 10px;">ç¿»å›è‡ªåŠ¨åœæ­¢ Â· éšæœºæ²»æ„ˆæ­Œå•</div>
                </div>
            </div>
        </div>

    </div>

    <div class="hint">ç‚¹å‡»å¡ç‰‡ç¿»é¢åˆ·æ–° Â· éŸ³ä¹å¡ç¿»å¼€åŠ è½½</div>

    <script>
        // ==================== 0. Spotify æ­Œå• (IDåˆ—è¡¨) ====================
        // è¿™äº›æ˜¯çº¯éŸ³ä¹ã€OSTã€æ²»æ„ˆç³»çš„ Track ID
        const trackIds = [
            "4DVk96500e26bdae5362j9", // æ²»æ„ˆé’¢ç´ (Experience - Einaudi)
            "1x5sYLZiu9r5E43kMlt9f8", // ä½ çš„åå­—OST (Sparkle)
            "4jTIaW9aiZ75HTF3gF814q", // æ˜Ÿé™…ç©¿è¶Š (Cornfield Chase)
            "75JFxkI2RXiU7L9VXzMkle", // åƒä¸åƒå¯» (One Summer's Day)
            "5zT5cMnMKae2dfrms2auDk", // å“ˆå°”çš„ç§»åŠ¨åŸå ¡ (Merry-Go-Round)
            "2Q2g4j6n72u8n39f7g8h9j", // æç®€é™è°§ (GymnopÃ©die No.1)
            "1dJ7c585c5d34658586940"  // æ²»æ„ˆå‰ä»–
        ];

        // è®°å½•å½“å‰æ’­æ”¾çš„iframeï¼Œæ–¹ä¾¿ç§»é™¤
        let currentIframe = null;

        // ==================== 1. ç¿»ç‰Œé€»è¾‘ ====================
        function flipCard(card, type) {
            const isFlipped = card.classList.contains('flipped');
            const spotifyContainer = document.getElementById('spotify-container');

            if (isFlipped) {
                // -> å‡†å¤‡åˆä¸Š
                card.classList.remove('flipped');
                
                // éŸ³ä¹å¡åˆä¸Šï¼šå½»åº•æ¸…ç©ºå®¹å™¨ï¼Œåœæ­¢éŸ³ä¹
                if (type === 'spotify') {
                    setTimeout(() => { 
                        spotifyContainer.innerHTML = '<div class="spotify-placeholder">åŠ è½½ä¸­...</div>';
                    }, 400); // ç¨å¾®å»¶è¿Ÿä¸€ç‚¹ï¼Œç­‰ç¿»è¿‡å»å†æ¸…ç©ºï¼Œé¿å…è§†è§‰é—ªçƒ
                }
                
                // å»¶è¿Ÿåˆ·æ–°å…¶ä»–æ•°æ®
                setTimeout(() => { refreshData(type); }, 600);

            } else {
                // -> å‡†å¤‡ç¿»å¼€
                card.classList.add('flipped');

                // éŸ³ä¹å¡ç¿»å¼€ï¼šæ’å…¥ Spotify Iframe
                if (type === 'spotify') {
                    loadSpotifyTrack();
                }
            }
        }

        // ==================== 2. Spotify åŠ è½½é€»è¾‘ ====================
        function loadSpotifyTrack() {
            const container = document.getElementById('spotify-container');
            
            // éšæœºé€‰ä¸€é¦–æ­Œ
            const randomId = trackIds[Math.floor(Math.random() * trackIds.length)];
            
            // æ„å»º Embed URL
            // theme=0 (é»‘è‰²ä¸»é¢˜)
            // autoplay=1 (å°è¯•è‡ªåŠ¨æ’­æ”¾ï¼Œä½†åœ¨éƒ¨åˆ†æµè§ˆå™¨éœ€ç‚¹å‡»)
            const embedUrl = `https://open.spotify.com/embed/track/${randomId}?utm_source=generator&theme=0&autoplay=1`;
            
            const iframe = document.createElement('iframe');
            iframe.style.borderRadius = "12px";
            iframe.width = "100%";
            iframe.height = "352";
            iframe.frameBorder = "0";
            iframe.allowFullscreen = "";
            iframe.allow = "autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture";
            iframe.loading = "lazy";
            iframe.src = embedUrl;
            
            // æ¸…ç©ºå®¹å™¨å¹¶æ’å…¥
            container.innerHTML = '';
            container.appendChild(iframe);
        }

        // ==================== 3. æ•°æ®åˆ·æ–°é€»è¾‘ ====================
        function refreshData(type) {
            const ts = new Date().getTime();

            if (type === 'art') {
                document.getElementById('art-img').style.backgroundImage = `url('https://img.paulzzh.com/touhou/random?t=${ts}')`;
            } 
            else if (type === 'fate') {
                const fateText = document.getElementById('fate-text');
                fateText.innerText = "?";
                fateText.style.color = "#8b0000";
            }
            // Spotify ä¸éœ€è¦åœ¨è¿™é‡Œåˆ·æ–°ï¼Œå› ä¸ºå®ƒåœ¨ç¿»å¼€æ—¶åŠ¨æ€ç”Ÿæˆ
        }

        // ==================== 4. å‘½è¿å åœé€»è¾‘ ====================
        const destinyOptions = ["æ­¤æ—¶è¡ŒåŠ¨", "é™è§‚å…¶å˜", "ç›¸ä¿¡ç›´è§‰", "å¤§åƒä¸€é¡¿", "ç«‹åˆ»ç¡è§‰", "å‡ºé—¨æ•£æ­¥", "å¤ä¹ åŠŸè¯¾", "é‡åˆ·ç•ªå‰§", "åšæŒå·±è§", "è”ç³»è€å‹"];
        function askDestiny(e) {
            e.stopPropagation();
            const textEl = document.getElementById('fate-text');
            let count = 0;
            textEl.style.color = "#8b0000"; textEl.style.transform = "scale(1)";
            const timer = setInterval(() => {
                const randomIndex = Math.floor(Math.random() * destinyOptions.length);
                textEl.innerText = destinyOptions[randomIndex];
                count++;
                if (count >= 15) {
                    clearInterval(timer);
                    textEl.style.color = "#d4af37";
                    textEl.style.transform = "scale(1.2)";
                    textEl.style.transition = "transform 0.2s";
                    setTimeout(() => textEl.style.transform = "scale(1)", 200);
                }
            }, 50);
        }
    </script>
</body>
</html>
